
只要我们不停下来，道路就会不断延伸。

1/16：Gui类
1/17：
1/18：
1/19:读入excel，使用json，使卡片数据初始化
20：hand类
21：(...看笔记本)
22：(...看笔记本)
23：技能文本
24：player类基础操作，以及与Gui的连接
25:完善，以及各种改bug，调试
26:
27：感觉这件事没有意义，或者是失去了热情，
28
29
30
31
1
2
3
4
5
6
7总结一下：基本按照skill的function来完成
8
9
10遍历玩家后不能保留设施状态栏





22-8-17：
初步设计网络端口类,以及相应的DataStorage，整理一下各个询问的返回值，将messagebox统一为askyesno（只是把诹访子的askyesnocancel改一下，因为取消使用的机制已经被弃用了，但没有改回来）。目前已知的取值类型只有int，bool，None。
如果要保证随机结果相同，必须保证操作和顺序一样，测试发现，任一个py文件之间设置seed，都会重置所有文件的seed。
熟悉一下三大类，稍微优化一下。

25:几个点：修改配色，

修改卡牌机制判断方法（直接由card类返回True or False，而不在其它类中判断，以实现分离实现）
1-能给予增益的设施发动时-buff
2-消逝-目前已弃用
3-迂返-reappear
4-克制-restraint
5-奇迹-miracle

目前当前玩家只有4个操作需要传递：捕获，发动设施，使用手牌，获得中央卡牌，
其他：克制也需要传递信息，以及部分奇迹效果

使用装饰器解决返回值暂存问题，包括各种询问

再列举些小问题：灵梦的获得还是需要特判...而且如果后续出现饭能代替钱的话，就要修改...


目前需要学习的东西：
修饰器
多线程
网络编程


23-1-22：
大概整理下思路，想先把能网络传递数据的部分做好，然后不联网测试单机情况下能否通过存储数据进行操作，最后组合起来

设计网络连接部分的布局

1-24
网络连接需要处理等待单人以及等待多人的请求，考虑下多线程实现的
在原有的messagebox上搞一个合适的新类
因为vscode没有主动提示类的方法，于是查了一下列表元素的类型声明，感觉文档注释和类型声明是个好习惯，主要是我以前用suublime，没有这么智能，所以没怎么管
当然小项目还好，项目一大，问题很容易有，养成良好习惯还是很关键的
现在把三大类了解一遍，加上各种注释和类型注解，方便vscode纠错和提示补全
然后测试还是分块测试吧，以前那种全盘测试真不适合...但是发现三大类有依赖关系，好像单独测不了...
此外，需要传递的函数也用装饰器处理？

代码问题
1.退治妖怪后似乎没有刷新可退治区的操作
2.判断能否获得的流程也可以思考下
例如洋馆，在获得设施前和之后各添加一个函数，前者在其需要钱时增加一点钱币，后者在获得设施后取消，没有获得成功时归还一块钱
3.将buff增减与触发、奇迹处理这种目前需要名字的特殊代码处理的改善
4.因为捕获妖怪和使用手牌类似，所以归于spell0函数，这。。。现在的我觉得不合理。。。
5.对Player.used用=[]清空了，这就是为什么显示不了已使用卡牌的原因
6.Gui的几个部件都是类变量和实例变量混用，要不同意一下（
7.设施发动过否的记录也许不应该由设施控件负责，此外，记录设施发动的部分存在比较多的问题，比如第八个框的更新会带来比较多的问题，而且设施框竟然没有重写append函数？令人震惊。像设施足够时，摧毁了了一个设施，新加入的设施可发动的问题
8.看完界面代码，我感觉Basic很牛逼，但是也会带来了些问题，因为妖怪区和设施区同样有着删除一项后，新加入的项会不判断能否点击的问题，这个问题和问题1类似
9.smalltop框大小有点怪，看看问题，可能需要测试几次看看合适的大小方案
10.newMessages也许应该在Gui里面调用？player里太滥用了。。。
11.复制效果可能带来的问题？


----------------几个游戏规则问题
1.妖怪退治时先发效果还是先从中央牌堆挪开
2.御柱，洋馆等的首次？获得不含钱币的设施对洋馆的影响
3.目前改为游戏人数加1个牌堆被拿完，大概得给个修改的方法，想什么时候结束都行？
4.折扇触发奇迹吗


1-26
昨天给Player加了注释，今天给Gui加注释，skill大概就不用吧，当然关系到联网的效果都要改写了
需要重新设计设施控件类，将发动等的逻辑代码转移到Player内处理，设施类只管显示就行了
看下skill类那些函数需要改写

1-27
把三大类放到game文件夹下了，毕竟是迟早的事
辉夜没有判断卡组有没有卡导致了bug，现在修改了
因为食物的特殊字符中文的json无法正常读取，改完之后中文的cardData能正常读取了，yeah~
现在想了想，得把网络连接部分放到另一个文件件下，不能让它与game相混合，不然又出现相互依赖的问题。。。

还是那句话，两部分分别测试，最后组合，除去这两部分外，还有一个重头戏是传递数据的协议（
除去一些比较极端的问题后，先本地开始模拟网络传递其他玩家操作的方法，然后这样对于确定协议会好些？毕竟编码是要与实际相关的

首先给需要取值的函数用个函数修饰

1-28
计划一下，操作重现需要三个环节：操作存储，操作传递，操作再现
存储和再现可以单机测试，传递单独测试，按着个分类来进行设计与实现即可

1-29
想了一下，操作重现不能依赖于模拟界面操作，不然不利于后续固定己方视角游戏

2-4
应当按照1-26的计划，将主要操作分离出来，进行存储保存为临时文件，然后重现
主要操作

御柱buff出问题了，得改
发现spell函数只要一个就好了，只有妖怪有额外的独有触发效果，角色只有被使用，设施只有被发动，这两类只有各一个独有的触发效果，而奇迹，buff之类的，都是不同类共有的。
我想把buff系统重写...麻的忍不了
buff添加的时机：使用手牌，或者回合开始时检查设施栏
所以重写card数据的读取，只给妖怪类两个数组记录效果，其他只用一个就够了。还有特殊效果就用special变量记录。
问题在于，buff类技能不是很好扩展...

2-5
消逝牌能否复制效果
for-else语句在正常结束（不break）时会运行else部分，而continue不影响，也就是说，只有在判断循坏条件发现不符合才会执行else语句，
---主要操作的前后处理
==操作前：判断是否当前玩家，不是直接退出
->开启记录模式,设置记录语句,在首部写入将操作对应的代号
==操作后:关闭记录模式
->获取操作结果,如果没有成功结算则直接退出，也不进行数据传输操作
->获取操作选择的记录,

getCover函数可能会返回一个None?
今天把设施发动相关的代码处理下,新添一个变量记录设施是否发动过,然后将界面点击与相应的界面变化不在界面类里处理,全部交由Player处理界面是否变化
关于询问值的问题，包括询问一个较小的数字，资源种类，

1#2#3#1#2#3_1


2-11
因为询问区域内的值时存在控件不可用但却可以
====操作时函数汇总：
1.获取中央卡牌：取消或者资源不足时返回False
2.使用手牌：不返回False
3.发动设施：取消发动或者不满足条件时返回False
4.捕获妖怪：同上
5.结束回合：直接进行，不返回False

可能添加的操作：
使用任意效果

2-12
====取值函数汇总：
1.询问是或否：转为0或1存储
2.询问数字：直接存储
3.询问字符串：目前只有早苗效果是必须的，有点难办，，，可以只修改早苗的函数，让它只获取是否猜对的结果
4.询问中央牌堆、手牌、设施、妖怪区域之一的一个值
5.询问三种资源种类之一，返回0,1,2,-2之一
6.询问多张卡牌之一
7.对卡牌排序效果

其中，返回一个整数的函数包括1,2，4,5,6,然后3可以改写避免来不必要存储字符串，7需要往队列内填充多个值，需要单独做修饰函数？

首先是需要把外部调用取值函数统一到Gui函数接口，这需要其他类不直接访问Gui成员中的函数，稍微排除了一下，只剩下增减buff还有一些无关痛痒的会直接访问Gui成员

备用资源的计算出了点问题，只有一个恶作剧妖精却有两点钱币备用

重现系统代号
1获取中央
2使用手牌
3发动设施
4捕获妖怪
5结束回合
6克制的弃牌抽牌

2-12
操作与取值的修饰函数基本正常，操作存储部分大概完成
在想能不能分离，将操作分为引发操作和附加操作，

操作发现，通过设定相同种子，可以完全复现随机性，nice
重现部分也不错，就是sleep会卡，窗口拖动会卡顿，有没有定时交还控制权的方法啊。。
还有状态队列的设计有问题，应当设置3种状态？只能取值，只能添加，既不也不。
重现部分出问题了，主要是放逐时会显示放逐界面，这不对啊。。

2-24
克制部分不好重现，如果克制卡抽到克制卡怎么结算？

计划一下，逐步实施操作重现，先本地记录重现，再建立传输协议，再边操作边传输并接受，再边操作边传递并重现

解决了3值以上的重现问题，御柱也神奇地重现了，高手

发现end和endAndNext并不在重现系统中相关，之前出过问题，但是现在查上面查不到...


3-1
接下来处理单机重现部分，以及纯粹的网络连接发送数据部分
先处理网络传输吧，然后边玩边传输，再解决特殊重现问题，最后合并运行

需要制定网络传输信息协议：
首先是要不要把CS


3-5
想做：存档系统，buff系统，扩展卡片等

3-10
cao，原来输出不及时是pirnt的问题，加个刷新缓冲就能做到读取长度后再读内容了，我是sb
还有，''!=b''
建一个MicroGensokyo类，把需要互通的函数统一在这里规划，一些重要变量也存进来
发现打开两个客户端的话，input只能停在一个上，并且是交替的，也就达不到选取客户端输出

大概可以把Player.cp从Player中分离出来，作为公共部分，这样谁都能调用了，不需要import Player了，解决很多问题..类似地似乎可以解决其他问题


3-12
import会把全局变量也包含进来，解决一下公共部分吧

看了下相互应用的部分，我心态崩了

先把单机重复部分弄完

联机部分时需要修改的效果：
奇迹：重建（传输数组）、传教（传输布尔数组）、放逐（放逐卡的位置以及索引）
摧毁他人设施类：恶鬼不需要，因为是自选的，老鼠不知道由谁选的。。。
早苗还好

奇迹处理一般是在其他卡的效果里的，也就是还没发送重现操作前就需要获取值，但是不发送又获取不了值，那咋办呢

结果今天啥也没干，傻了

3-13
把房间类的增删改写了一下，公共的playerLabel放到了Info里，舒服了

3-14
把连接socket的控件整理一下，添加了消息框


3-29
怎么这么多天没搞了...
想了一下，得用观察者模式设计一下buff系统，不过目前倒不紧要
然后是单独测试RoomPage了
以及Info是否会显得臃肿？

4-2
列举一下roomPage的操作在实现
我不太想让它想GUI一样每次都要经过GUI代理怎么办（，可以让子组件绑定父窗口的回调函数耶..
-首先是进入以及隐藏RoomPage

网络连接通信：


以及将无需网络通信的messagebox分离出来，避免可能的问题
现在整合起RoomPage的属性，感觉也挺麻烦的...主要保证socket和PlayerList保证对应，以及开始游戏后信息一致

逻辑写多了人都晕了，难顶

整合起来还是那个问题，相互引用怎么办，
主要是不显式声明，ide不能智能提示；显式声明又会循环引用..果然Python不适合写大项目，没智能提示感觉会si...

对于房间人员变化，增删都是非界面操作触发的，也就是直接后台进行网络通信
只有修改属性是按钮触发的，所以需要用修饰函数解决


4-4
过一遍三人游戏的网络连接过程：
1.首先是服务端，进入RoomPage后自动创建一个PlayerLabel作为本人的信息，可以修改；同样地两个客服端进入RoomPage也会创建，以及可以修改，未连接时，修改不触发通信

2.服务端开启服务：
设置0号为本地玩家，不进行房间重置

3.第一位客服端连接：
暂存该玩家的信息，清空房间，发送信息到服务器，待服务器更新完后，再接受服务器的玩家信息列表，（然后加入暂存信息里的PL，）

服务器接受连接，在本地执行添加操作，然后对其他客户端通信，（由于没有，所以实际上不发生）

4.第二位客服端连接：
类似上者，区别是服务器执行完本地操作后，会对第一个客户端发送添加玩家通知

所以服务器接受信息后，执行本地操作，再对所有非发送客户端的socket发送同步信息（自身不包含在内）


4-5
服务器：
接受信息：
首先在本地执行，然后此时本地以及发送者已经更新了，所以遍历客户端列表，对其他未更新的客户端通信
奇迹时的效果可能会混乱？

想了下，先实现玩家变动吧，正常后再进行操作通信
注意连接操作是原子操作，报错需要重置，具体要怎么实现有点麻烦，没办法，网络通信我不是很懂
服务器初建以及玩家刚连接时，由服务器赋予默认配置吧
目前所有监听连接函数都不会在出错时break而是只在接受到空信息时break
通信遇到None怎么办
通信涉及bytes，传递时注意一下，只在处理时将其转为str？bytes和str打印时倒没啥差别，而且int化也一样，所以传递时都用bytes吧。
要不连接上后设置
添加了设定本地玩家在房间里的编号的通信

4-6
应该把容易出错的操作提前，这样出错时损失较小
判断对方是否终止了连接，是判断==b''好还是判断长度==0好？

4-8
bytes和str混乱了，一些函数像split只有str能用...
不能用str（）将bytes转变为str，因为会带着b''，
测试了一下连接，双人时还好，三人时第二人接收不到变化

4-9
原来是我疏忽了listen开新连接忘了通知了
cao，关闭socket只要调用close就行了，shutdown个屁

4-10
房间内的多人通信大概搞完了，接下来和GUI联合，然后就是游戏内通信了
还是得重写buff系统，至于要不要更好地解耦，暂时不提罢，能跑就行
place是否有记忆？
对于是否当前玩家点击的触发回调，通过界面上的点击时回调函数处理，按理来讲不是当前玩家点击之后也会修改var；而对于是主动选择还是被动触发的情况，通过内在的操作时函数处理，
感觉分段写太他吗优雅了，一长坨下来一点看的欲望都没有，而且也不好定位和读懂
如果真要上线，得把useall给取消掉，主要是忽然短时间内大量的操作还是存在风险，反正没几张牌，慢慢点吧

暂时先停用交互效果，慢慢来...
bytes不能视为char数组，不能用索引取值

4-11
草，操作重现通信前头没加2_,所以出问题了
ok，已经可以传递和复现操作了，~~~~~~~~~~~~~~~~~~~~~~
草，发现问题还挺多，慢慢来
比如Info没有更新到当前玩家，全部使用却没有传递，操作了却没有发送

4-12
写一下一些想法
抽象基类好像就是为了避免相互耦合的，以及buff系统还是重写成一个类好一点，
触发操作时的修饰函数没有？测试了一下，修饰类的方法的函数只有一个生效
理想状态下是这样的
click 0 0
Call back for using
When operating.    
Op begin.
player using:
Op end normally.
Sending operation 2_2_4
State: 1
Send to Clients: b'00052_2_4'

但是只有一个实例的对象能达到，其他对象是这样的：
click 1 1
Call back for using
When operating.
player using:

它们本地能执行操作，但是没有通信
哦，原来是我重现操作后没有将ds设置会normal，解决了
完了，玩个4轮，就他妈掉线了，为什么
发现了，因为通信消息是以下划线结尾，ok，因为对ds编码时调用了clear，最近刚改的，傻了
草，才发现克制询问的是上一个玩家
辉夜函数还没有可传递
阿空效果卡住了，按了下ctrl+q又正常了

4-14
接下来就是特殊通信，包括奇迹，卡牌排序，摧毁效果了
以及重写buff系统，扩展卡牌了
发现奇迹效果都不涉及乱序打乱耶，挺好的（一轮的打乱是统一顺序的），至于西行妖，我觉得这效果就很难受，不太想搞
至于卡牌排序，包括折扇和辉夜效果还好解决
设计buff系统也不难吧，就是烦
然后是通过抽象类分离出公共接口的方法，也不难，就是烦
还有怎么在低版本的python中运行？按我的理解是删了变量类型声明就能在3.7跑了，然后没了f-striing就能在3.5跑了

列举一下需要改动的效果：
奇迹：重建、删牌、传教、（恶鬼、老鼠）
需要改动的询问：Gui.sort方法

然后是测试多人游戏，多主机游戏了
本地三人可以游戏，没问题

4-19
必要的事是要修改特殊的sortThree，奇迹，以及一些无需传递的messagebox区分
然后是考虑
需要改善的系统：中央牌堆类，buff系统，重新连接系统

4-25
考虑下奇迹的实现：

在卡牌处理过程中，当翻开中央牌堆，触发奇迹时，
本地中断单元操作，向服务器发送奇迹前的队列，
服务器接受后开启计数模式，然后向其他人发送奇迹前操作，首部码采用2
其他人本地重现操作再选取奇迹后传递回服务器，头部用 ，服务器接受、保存并计数，
当服务器计数满后，再统一分发给所有人，头部用 。
服务器再接受当前玩家特定中断开头码的信息（头部为 ），继续操作

看了一下，折扇效果竟然把没有修改后的cards的返回值，也就是None，之前没报错？


4-26
处理一下任意效果的通信，以及将获取任意一张牌设置为一个技能
好了，任意技能可以传递和重现了
然后写了下sortThree，现在能传递技能了，就好测试了

4-29
想了想，还是得新建一个类，作为要发送的操作信息的描述，这样才方便管理，不然无法实现单元操作的分割，也就不能中断操作实现奇迹对操作的中断了

4-30
折扇效果大抵没问题了
辉夜效果有问题，应该迂返都有问题，玩家切换要分两步走，不对，迂返效果只有辉夜需要选择，其他都是对玩家自动发动，还有，迂返和克制谁先？按开始和出牌来分的话，先克制后迂返。

先写个新类，用作操作的传递中间件，然后测试
再重写奇迹相关的函数，测试
解决一下辉夜的问题

将回合结束与变换玩家分离开来，结束之后，判断是否当前玩家，是则操作，再通信使他人复现
原则是，end函数不能调用next，所以整合起来得到endAndNext函数，在这个函数判断结束后是否当前玩家，如果不是直接通信告诉别人已经结束，然后让下一位玩家开始他的回合开始的操作，操作完了再通信一次告知他人
如果有咲夜效果，这样分离容易出问题，想了想，把结束函数脱离afterOperation算了
如果不修饰ean而修饰end和next，那么

辉夜的迂返大致解决了...

然后是奇迹问题
理论上切换非本回合玩家时，界面不需要record了，但是因为设施按键颜色还是得保留的，还是得record
阻塞不发生在奇迹函数，而是相应的玩家函数的ds.get过程

处理了skill的奇迹函数，接下来是connecter和其他杂类

5-1
奇迹需要传递给服务器本地玩家的序号，按理来讲thisPlayer应该可以，问题在于要是有人中途退出了怎么办（
添加一个在连接界面和游戏界面切换的按钮
我感觉就是，主页，连接页和游戏界面应当分成三个类来写
还有一个问题是Gui作为中介传递给自己的成员信息好不好的问题
还有handle函数是不是应该交给各自的类处理为好，感觉很冗杂
奇迹存在一个先放后取的情况，大概需要不断地清空队列
ds到达尾部后自动清零是否会出问题（
想了想，比较局部的变量可以简单命名，但是稍微全局点的都好好命名吧
在想分成两个队列，一个存一个取怎么样
辉夜洗牌没有提示...
早苗通信有问题，取消掉askstring的修饰函数就好了，本身他就不需要修饰吧。。。
草，获取任意卡牌的not把返回0的结果也视为出错了
药壶有问题，因为自毁后查询facility越界了
老鼠和恶鬼的效果要不都由触发者选择吧
村纱是因为取值时Gui是sepcial的，而取消按钮被whenClick修饰了，把这个修饰取消就好了

辉夜位置 4 2
折扇位置 5 3
早苗位置 0 1
村纱  1 0
咲夜 


大概完整过完了一遍，接下来调一下颜色和提示，录视频了

5-2
想了想，还是排查下比较好，任何细小的问题都可能造成严重的后果
原来是turnCount没有初始化，就调用next了
还有加入操作记录功能，写到文件里去，方便从头重现
原来是因为服务器接受结束操作后，先自己进行了next操作并通信，导致了其他客户先接受了服务器的next再接受结束操作

5-3
大概完整地过了一遍
业障效果倒没什么
咲夜的砸瓦鲁多直接把客户端全搞掉线了，看了一下，是先next后end了，把通信放在服务器操作重现前就可以防止服务器执行endAndNext时发送next通信了，然后就单独修饰end和next，但是调用重现end时调用endAndNext就可以了